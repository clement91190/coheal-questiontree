<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
        <script>
            function add_mode(id){  
                $("#tt" + id).show();
                $("#at" + id).hide();
                $("#mt" + id).show();
                return false;}

            function normal_mode(id){
                $("#mt" + id).hide()
                $("#at" + id).show()
                addtag(id);
                $("#tt" + id).hide();
                return false;}
            
            function modifier(id){  
                $("#qt" + id).show();
                $("#s" + id).show()
                $("#m" + id).hide()
                return false;}

            function sauver(id){
                $("#m" + id).show()
                $("#s" + id).hide()
                $("#qt" + id).hide();
                postqtext(id);
                return false;}
            
            var machin = 0;

            function postqtext(id){
                var data = {
                    q_id:  id,
                    qtext: $("#qt" + id).val()};
                $.post("findandmodify", data, 
                    (function(data, status){
                        $("#lb" + id).text(
                        $.parseJSON(data).question_text)
                        machin = $.parseJSON(data)
                        })
                    );}

            function update_question(data, status, id){
                // update question_text
                $("#lb" + id).text(
                    $.parseJSON(data).question_text);
                question = $.parseJSON(data) ;
                
                var code = "";
                
                for (var i =0; i< question.tags.length; i++ )
                {
                    code += " <mark class='tags'>";
                    code += question.tags[i] + " </mark>";
                    code += "<button class='del'> X </button>"
                }

                $("#tg" + id).html(code);
                $("#tg" + id).children(".del").each(function(i){
                    $( this ).click(function(){deltag(id, i)})});

            }

            function addtag(id){
                var data = {
                    q_id:  id,
                    tag_text: $("#tt" + id).val()};
                $.post("addtag", data,(function(data, status){
                    update_question(data, status, id)}) );
                }

            function deltag(q_id, tag_id){
                var data = {
                    q_id: q_id,
                    tag_id : tag_id}
                $.post("deltag", data,(function(data, status){
                    update_question(data, status, id)}) );
                }
        </script>
        
        
        <title>Modify one </title>
    </head>
 
    <body>
     <div class='question'>
        <h2> Symptome : {{question.q_id}} {{question.symptome}}</h2>
            <div>
             <h3> Tags : </h3> 
                <div id="tg{{question.q_id}}">   
                {% for i,t in enumerate(question.tags) %}
                <mark class='tags'> {{ t }} </mark>
                <button class='del' onclick=deltag({{question.q_id}},{{i}})> X </button>
                {% endfor %}
                </div>    
                <input type="text" id="tt{{question.q_id}}">   
            <button class='addtag' id="at{{question.q_id}}"> + </button>
            <button class='addtag' id="mt{{question.q_id}}"> Modifier </button>
            </div>

<form> 
            <h3> Texte de la question pour le patient : </h3>
            <label id="lb{{question.q_id}}">{{question.question_text}} </label>
            <input type="text" id="qt{{question.q_id}}"> </input>
            <button class ='modify' id="m{{question.q_id}}"> Modifier</button>
            <button class ='modify' id="s{{question.q_id}}"> Sauver</button>
        </form>
     </div>
                
                
                
     <script> 

        var id = {{question.q_id}};
        $("#qt{{question.q_id}}").hide(); // hide the form 
        $("#tt{{question.q_id}}").hide(); // hide the form 
        $("#m" + id).click((function(){return modifier(id)})); 
        $("#s" + id).click((function(){return sauver(id)})); 
        $("#at" + id).click((function(){return add_mode(id)}));
        $("#mt" + id).click((function(){return normal_mode(id)}));
        $("#mt" + id).hide()
        $("#s" + id).hide()
     </script>

    </body>
</html>
