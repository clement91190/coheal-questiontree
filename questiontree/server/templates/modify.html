<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
      <script>
          var id;
            function delete_question(id){
                if (confirm("Etes vous sur de vouloir supprimer cette question?"))
                {postdeleteq(id);}
                return false;}

            function add_mode(id){  
                $("#tt" + id).show();
                $("#at" + id).hide();
                $("#mt" + id).show();
                return false;}

            function normal_mode(id){
                $("#mt" + id).hide()
                $("#at" + id).show()
                addtag(id);
                $("#tt" + id).hide();
                return false;}
            
            function modifier_symptome(id){  
                $("#ts" + id).show();
                $("#ss" + id).show()
                $("#ms" + id).hide()
                return false;}

            function sauver_symptome(id){
                $("#ms" + id).show()
                $("#ss" + id).hide()
                $("#ts" + id).hide();
                postsymptome(id);
                return false;}
            
            function modifier(id){  
                $("#qt" + id).show();
                $("#s" + id).show()
                $("#m" + id).hide()
                return false;}

            function sauver(id){
                $("#m" + id).show()
                $("#s" + id).hide()
                $("#qt" + id).hide();
                postqtext(id);
                return false;}
            
            var machin = 0;
             
            function postdeleteq(id){
                var data = {
                    q_id:  id}
                    $.post("delquestion", data, 
                    (function(data, status){
                    $("#q" + id).remove();
                    }));}


            function postsymptome(id){
                var data = {
                    q_id:  id,
                    symptometext: $("#ts" + id).val()};
                    $.post("findandmodifysymp", data, 
                    (function(data, status){
                        $("#lbs" + id).text(
                        $.parseJSON(data).symptome)
                        })
                    );}


            function postqtext(id){
                var data = {
                    q_id:  id,
                    qtext: $("#qt" + id).val()};
                $.post("findandmodify", data, 
                    (function(data, status){
                        $("#lb" + id).text(
                        $.parseJSON(data).question_text)
                        })
                    );}

            function update_question(data, status, id){
                // update question_text
                response = $.parseJSON(data) ;
                $("#lb" + id).text(
                    response.question.question_text);
                
                var code = "";
                
                for (var i =0; i< response.question.tags_ids.length; i++ )
                {
                    code += " <mark class='tags'>";
                    code += response.tags[i]+ " </mark>";
                    code += "<button class='del'> X </button>"
                }

                $("#tg" + id).html(code);
                $("#tg" + id).children(".del").each(function(i){
                    $( this ).click(function(){deltag(id, i)})});

            }

            function addtag(id){
                var data = {
                    q_id:  id,
                    tag_text: $("#tt" + id).val()};
                $.post("addtag", data,(function(data, status){
                    update_question(data, status, id)}) );
                }

            function deltag(q_id, tag_id){
                var data = {
                    q_id: q_id,
                    tag_id : tag_id}
                $.post("deltag", data,(function(data, status){
                    update_question(data, status, q_id)}) );
                }
        </script>
       
    <title>Generateurs de questions</title>
  </head>
 
  <body>
    <div>
        <p> Sur cette interface, vous pouvez acceder aux differentes questions et les modifier, en particulier proposer un texte comprehensible par l'utilisateur, modifier son importance ...</p>
    </div>

    <div>
      <button class='onglet' onclick="location.href='/modify';"> Question liee a un symptome  </button>
      <button class='onglet' onclick="location.href='https://docs.google.com/document/d/1ekkAjodN5IdhoQhNC4Inz4Mvw2NDMG4J7ssU6YAWfIA/edit?usp=sharing';"> Question generique </button>
    </div>
   
    {% for q in questions %}
    <div class='question' id="q{{q.q_id}}">
        <form>
            <h2> Symptome : {{q.q_id}} <label id="lbs{{q.q_id}}">{{q.symptome}} </label></h2>
            <input type="text" id="ts{{q.q_id}}">   
            <button class ='modify' id="ms{{q.q_id}}"> Modifier</button>
            <button class ='modify' id="ss{{q.q_id}}"> Sauver</button>
            <button class ='delquest' id="dq{{q.q_id}}"> Supprimer</button>
        </form>
    <div>
        <h3> Tags : </h3> 
            <div id="tg{{q.q_id}}">   
            {% for i,t in enumerate(q.tags_ids) %}
            <mark class='tags'> {{ tags[t] }} </mark>
            <button class='del' onclick=deltag({{q.q_id}},{{i}})> X </button>
            {% endfor %}
            </div>    
            <input type="text" id="tt{{q.q_id}}" class="searchtags">   
        <button class='addtag' id="at{{q.q_id}}"> + </button>
        <button class='addtag' id="mt{{q.q_id}}"> Modifier </button>
        </div>

<form> 
            <h3> Texte de la question pour le patient : </h3>
            <label id="lb{{q.q_id}}">{{q.question_text}} </label>
            <input type="text" id="qt{{q.q_id}}"> </input>
            <button class ='modify' id="m{{q.q_id}}"> Modifier</button>
            <button class ='modify' id="s{{q.q_id}}"> Sauver</button>
        </form>
     </div>
                
                
                
     <script> 

        $("#ts{{q.q_id}}").hide(); // hide the form 
        $("#tt{{q.q_id}}").hide(); // hide the form 
        $("#qt{{q.q_id}}").hide(); // hide the form 
        $("#ms" + {{q.q_id}}).click((function(){return modifier_symptome({{q.q_id}})})); 
        $("#ss" + {{q.q_id}}).click((function(){return sauver_symptome({{q.q_id}})})); 
        $("#dq" + {{q.q_id}}).click((function(){return delete_question({{q.q_id}})})); 
        $("#m" + {{q.q_id}}).click((function(){return modifier({{q.q_id}})})); 
        $("#s" + {{q.q_id}}).click((function(){return sauver({{q.q_id}})})); 
        $("#at" + {{q.q_id}}).click((function(){return add_mode({{q.q_id}})}));
        $("#mt" + {{q.q_id}}).click((function(){return normal_mode({{q.q_id}})}));
        $("#mt" + {{q.q_id}}).hide()
        $("#s" + {{q.q_id}}).hide()
        $("#ss" + {{q.q_id}}).hide()

     </script>


    
    {% endfor %}



    <script> 
        $(function() {
    $( ".searchtags" ).autocomplete({
        source: function(request, response){
                
                var data = {
                    key:  request.term};
                $.get("search_tags", data, 
                (function(data, status){
                    response($.parseJSON(data).tags);
            }));
        }

            
    });
  });</script>``
   </body>
</html>
